<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>match函数</title>
</head>

<body>
    <div>
        <div id="id"></div>
    </div>
    <script>
        // 分解所有得复杂选择器
        var selector = []
        var token = ''

        function match(selectors, element) {
            // 拆分选择器
            // 对于统配符不做任何处理
            var selectors = selectors.replace('*', '')
            // 对于伪类和伪元素也是删除后不做任何处理
            let reg = /(:)+\w+/g
            selectors = selectors.replace(reg, '')
            // 对于属性选择器不会处理
            // 以空格来分开
            // 要一级级往父元素找
            selectors = selectors.split(" ").reverse()
            selectors = selectors.filter(v => v !== "")

            // 从后往前匹配
            var result = true
            for (let selector of selectors) {
                // if (!result) { return false }
                result = compareSelector(selector, element)
            }
            return result
        }


        function compareSelector(selector, element) {
            // 检测是否id属性器
            console.log(selector)
            if (selector.match(/(#){1}(\w+)/g)) { //id
               if(element.attributes['id'].value === selector.substring(selector.indexOf('#')+1,selector.length) ){
                   return true
               }else{
                   return false
               }
            } else if (selector.match(/(.){1}\w+\W/)) { // 属性
                console.log('attr')
                if (!document.querySelector(selector)) {
                    return false
                } else {
                    return true
                }
            } else if (selector.match(/^(\.\w+){0,1}$/)) { //class
                console.log('class')
                if(!element.attributes['class']){
                    return false
                }
                if(element.attributes['class'].value === selector.substring(selector.indexOf('.')+1,selector.length) ){
                   return true
               }else{
                   return false
               }
            }else{
                console.log(element.tagName)
                console.log(selector)
                if(element.tagName === selector.toUpperCase()){
                    return true
                }else{
                    return false
                }
            }
        }

        console.log(match("* div #id .cls", document.getElementById("id")))
    </script>

    <script>

    </script>
</body>

</html>